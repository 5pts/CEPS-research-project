
# CEPS Data Cleaning & Rescue - Change Log Report
**Version:** Rescue V2.0 (Official)
**Date:** 2025-12-28
**Status:** Verified & Locked

---

## 1. 变更清单 (Change Manifest)

| 变更ID | 变更项 | 内容描述 | 实施时间 | 影响评估 |
| :--- | :--- | :--- | :--- | :--- |
| **C-01** | **SES 变量修正** | 修正家长收入变量映射，从 `be01` 扩展至 `w2be01`，激活第二层级填补逻辑。 | 2025-12-28 | **关键影响**：成功挽回 3887 个 SES 缺失样本，使最终 SES 缺失率降至 0%。 |
| **C-02** | **联结键统一** | 统一全流程外键口径：班级 `w2clsids` -> `clsids`，学校 `w2schids` -> `schids`。 | 2025-12-28 | **高影响**：确保了 9903 名学生能正确关联到教师数据，10750 名学生关联到学校数据。 |
| **C-03** | **保留率口径** | 统一“保留率”定义为：仅剔除因变量 (`w2b18`) 缺失样本。 | 2025-12-28 | **中影响**：消除报告间数字冲突，统一锁定最终样本量为 **9827**。 |
| **C-04** | **旧报告归档** | 标记 `merged_data_quality.txt` 等旧报告为 `.old`，确立 V2.0 报告为唯一真源。 | 2025-12-28 | **低影响**：防止误用过时数据，提升文档可维护性。 |

---

## 2. 报告一致性核查 (Consistency Check)

| 核查点 | `analyze_data_quality.py` (分析端) | `clean_ceps_rescue.py` (清洗端) | 结论 |
| :--- | :--- | :--- | :--- |
| **学生主键** | `ids` | `ids` | ✅ **一致** |
| **班级外键** | 识别 `w2clsids` 并重命名为 `clsids` | 识别 `w2clsids` 并重命名为 `clsids` | ✅ **一致** |
| **学校外键** | 识别 `w2schids` 并重命名为 `schids` | 识别 `w2schids` 并重命名为 `schids` | ✅ **一致** |
| **SES 救援源** | 检查 `w2be01` 可用性 (3887 可用) | 使用 `w2be01` 进行填补 | ✅ **一致** |
| **最终样本量** | 模拟结果：**9827** | 实际输出：**9827** | ✅ **一致** |

---

## 3. 准确性核验 (Accuracy Validation)

### 3.1 关键数据交叉验证
*   **原始样本**：10750 (全库一致)
*   **因变量缺失**：923 (全库一致)
*   **理论最大保留样本**：10750 - 923 = **9827**
*   **实际输出样本**：**9827** (无额外损耗)

### 3.2 逻辑正确性
*   **SES 填补链**：学生自报 -> 家长报告 (`w2be01`) -> 班级均值。逻辑闭环，无死角。
*   **Hukou 填补链**：学生自报 -> 学校位置 (`schids` 关联) -> 班级/全局众数。逻辑闭环。
*   **教师数据匹配**：基于 `clsids` 匹配，覆盖率 92.1% (9903/10750)，符合预期（部分班级确实无教师问卷）。

### 3.3 结论
当前 **Rescue V2.0** 流程逻辑严密，口径统一，数据质量报告真实反映了清洗结果。

---

**Sign-off:**
*   **Technical Lead:** Trae AI
*   **Date:** 2025-12-28
